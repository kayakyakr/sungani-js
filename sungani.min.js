// MIT License, see https://github.com/kayakyakr/sungani-js
(function(){try{Sungani}catch(a){Sungani={url:"http://www.sungani.com"}}Object.defineProperties(Sungani,{ajax:{value:function(a){var b={url:a.url,type:a.method||"GET",dataType:"json",headers:{"X-AUTH-TOKEN":Sungani.User.authentication_token||localStorage&&localStorage.getItem("sungani_authentication_token")}};a.scope&&(b.context=a.scope),a.success&&(b.success=a.success),a.failure&&(b.failure=a.failure),a.callback&&(b.complete=a.callback),a.params&&(b.data=a.params),$.ajax(b)}}})})(),function(){MicroEvent=function(){};var a=function(){this._events||Object.defineProperty(this,"_events",{value:{},enumerable:!1,configurable:!1})};MicroEvent.prototype={bind:function(b,c){a.call(this),this._events[b]=this._events[b]||[],this._events[b].push(c)},unbind:function(b,c){a.call(this);if(b in this._events==0)return;this._events[b].splice(this._events[b].indexOf(c),1)},trigger:function(b){a.call(this);if(b in this._events==0)return;for(var c=0;c<this._events[b].length;c++)this._events[b][c].apply(this,Array.prototype.slice.call(arguments,1))}},MicroEvent.mixin=function(a){var b=["bind","unbind","trigger"];for(var c=0;c<b.length;c++)Object.defineProperty(a.prototype,b[c],{value:MicroEvent.prototype[b[c]],enumerable:!1,configurable:!1})},typeof module!="undefined"&&"exports"in module&&(module.exports=MicroEvent)}(),Object.apply=function(a,b){for(var c in b)a[c]=b[c]},Object.applyIf=function(a,b){for(var c in b)a[c]===undefined&&(a[c]=b[c])},Array.prototype.shuffle=function(){var a,b,c=this.length;if(c)while(--c)b=Math.floor(Math.random()*(c+1)),a=this[b],this[b]=this[c],this[c]=a;return this},function(){var a=function(a){};MicroEvent.mixin(a),Object.defineProperties(a.prototype,{load:{value:function(){Sungani.ajax({method:"GET",url:Sungani.url+"/games/"+Sungani.Game.id,success:function(a,b,c){Object.apply(this,a),this.trigger("load")}.bind(this)})},writeable:!1,configurable:!1}}),Sungani.Game=new a}(),function(){var a=function(a){},b=null;MicroEvent.mixin(a),Object.defineProperties(a.prototype,{load:{value:function(a){var b={method:"GET",url:Sungani.url+"/matches/"+a,scope:this,success:function(a,b,c){if(a.updated_at&&a.updated_at===this.updated_at)return;Object.apply(this,a),this.trigger("load")}};a===this.id&&this.updated_at&&(b.params=b.params||{},b.params.updated_at=this.updated_at),this.updated_at=null,Sungani.ajax(b)},enumerable:!1,writeable:!1,configurable:!1},refresh:{value:function(){this.load(this.id)},enumerable:!1,writaeable:!1,configurable:!1},save:{value:function(){Sungani.ajax({method:"PUT",url:Sungani.url+"/matches/"+this.id,scope:this,params:{match:JSON.stringify(this)},success:function(a,b,c){Object.apply(this,a),this.trigger("save"),this.trigger("load")}})},writeable:!1,configurable:!1},create:{value:function(a){Sungani.ajax({method:"POST",url:Sungani.url+"/matches",params:{game_id:Sungani.Game.id,users:a},scope:this,success:function(a,b,c){Object.apply(this,a),this.trigger("create")}})},writeable:!1,configurable:!1},start_polling:{value:function(){if(b)return;b=setInterval(function(){this.refresh()}.bind(this),15e3)},writeable:!1,configurable:!1},stop_polling:{value:function(){clearInterval(b),b=null},writeable:!1,configurable:!1}}),Sungani.Match=new a}(),function(){var a=function(a){};MicroEvent.mixin(a),Object.defineProperties(a.prototype,{signIn:{value:function(a,b){Sungani.ajax({method:"POST",url:Sungani.url+"/users/sign_in.json",params:{"user[email]":a,"user[password]":b},scope:this,success:function(a,b,c){this.id=a.id,this.name=a.name,this.authentication_token=a.authentication_token,localStorage&&localStorage.setItem("sungani_authentication_token",a.authentication_token),this.trigger("signedin")},failure:function(){this.id=null}})}},signOut:{value:function(){Sungani.ajax({method:"GET",url:Sungani.url+"/users/sign_out.json",scope:this,success:function(a,b,c){this.id=null,this.name=null,this.authentication_token=null,localStorage&&localStorage.setItem("sungani_authentication_token",null),this.trigger("signedout")}})}},checkSignedIn:{value:function(){Sungani.ajax({method:"GET",url:Sungani.url+"/users/signed_in.json",scope:this,success:function(a,b,c){a.signed_in?(this.id=a.id,this.name=a.name,this.authentication_token=a.authentication_token,localStorage&&localStorage.setItem("sungani_authentication_token",a.authentication_token),this.trigger("signedin")):(this.id=null,this.name=null,this.authentication_token=null,localStorage&&localStorage.setItem("sungani_authentication_token",null),this.trigger("signedout"))}})}},isSignedIn:{value:function(){if(this.id!==undefined&&this.id!==null)return!0;if(localStorage){var a;if(a=localStorage.getItem("sungani_authentication_token"))return Sungani.User.authentication_token=a,this.checkSignedIn(),!0}return!1}},index:{value:function(){Sungani.ajax({method:"GET",url:Sungani.url+"/users.json",scope:this,success:function(a,b,c){this.trigger("index",a)}})}}}),Sungani.User=new a}();